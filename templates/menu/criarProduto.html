<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Menu</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/styles.css') }}">
</head>
<body>
    <header class="cabeçalho1">
        <div class="options">
            <a href="/menu/principal"><h4>Menu</h4></a>
        </div>

        <div class="perfil">
            <h3> Bem vindo</h3>
            <a href="/auth/sair"><img src="https://cdn-icons-png.flaticon.com/512/6218/6218420.png" alt=""></a>
        </div>
        
    </header>
    {% if mensagem !="" %}
    <div class="mensagem">
        <h3>{{mensagem}}</h3>
    </div>
    {% endif %}

    <main class="corpo">
        <h1>Cadastrar Produto</h1>
        <form action="{{ url_for('produto.cadastrar') }}" method="POST" enctype="multipart/form-data">

            <h3>{{erro}}</h3>
            <label for="nome">Nome Completo</label>
            <span class="error-message" id="nameError"></span>
            <input type="text" id="name" name="name">

            <label for="imagem">Selecione Uma Imagem</label>
            <span class="error-message" id="imagemError"></span>
            <input type="file" name="imagem" id="imagem"required>

            <input type="submit" value="Cadastrar Produto">
        </form>

    </main>
    <script>
        document.querySelector("form").addEventListener("submit", function (e) {
            let name = document.getElementById("name").value.trim();
            let image = document.getElementById("imagem").files[0];
            
            let nameError = document.getElementById("nameError");
            let imageError = document.getElementById("imagemError");
        
            // Resetando mensagens de erro
            nameError.textContent = "";
            imageError.textContent = "";
        
            let isValid = true;
        
            // Validação do nome
            if (name.length < 3) {
                nameError.textContent = "O nome deve ter pelo menos 3 caracteres.";
                nameError.style.color = "red";
                isValid = false;
            }
        
            // Validação da imagem
            if (!image) {
                imageError.textContent = "A imagem é obrigatória.";
                imageError.style.color = "red";
                isValid = false;
            } else {
                let allowedExtensions = ["jpg", "jpeg", "png", "gif"];
                let fileExtension = image.name.split(".").pop().toLowerCase();
                if (!allowedExtensions.includes(fileExtension)) {
                    imageError.textContent = "Formato inválido. Use JPG, JPEG, PNG ou GIF.";
                    imageError.style.color = "red";
                    isValid = false;
                }
        
                if (image.size > 2 * 1024 * 1024) { // Limite de 2MB
                    imageError.textContent = "O arquivo deve ter no máximo 2MB.";
                    imageError.style.color = "red";
                    isValid = false;
                }
            }
        
            // Se houver erro, impedir envio do formulário
            if (!isValid) {
                e.preventDefault();
            }
        });
        </script>
        
</body>
</html>